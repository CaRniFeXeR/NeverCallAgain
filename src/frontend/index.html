<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Call Management</title>
    <script type="module" crossorigin src="/static/frontend_build/assets/index-618e06d7.js"></script>
    <link rel="stylesheet" href="/static/frontend_build/assets/index-1d3f8eee.css">
  </head>
  <body>
    <div id="app"></div>
    <button id="call_btn">start call</button>
    <button id="close_btn">stop call</button>
    <div id="audio_container"></div>
  </body>
</html>
<script>
const close_btn = document.getElementById("close_btn");
close_btn.addEventListener("click", async () => {
  console.log("stopping call")
  var div = document.getElementById("audio_container")

  div.innerHTML = `` //remove audio element


  const data = { text_input: "close request" };
  const options = {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(data)
  };

  fetch('/reset_conv', options)
    .then(response => {
      console.log("call reseted")
    })
    .catch(error => console.error(error));

  if (globalAudioCtx != null){
    globalAudioCtx.audioWorklet.removeModule("./static/processor.js") //remove microphone listener
  }

  if (micProcessor != null){
    micProcessor.disconnect()
  }
});
</script>


